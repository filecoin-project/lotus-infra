image:
  pullPolicy: Always
  tag: "1.2.0"

indexResolver:
  replicas: 3
  s3Resolver:
    bucket: "filecoin-snapshots-mainnet-production"
    endpoint: "https://eafecb340a3ce23027e1eba779ed4d91.r2.cloudflarestorage.com"
    secretName: r2-access

  loadBalancer:
    enabled: true
    annotations:
      service.beta.kubernetes.io/aws-load-balancer-backend-protocol: http
      service.beta.kubernetes.io/aws-load-balancer-ssl-cert: arn:aws:acm:us-east-1:759815798766:certificate/5e9eb742-7d50-4ac9-b1e2-4fe4c1f5f5a1
      service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"
      external-dns.alpha.kubernetes.io/hostname: snapshots.mainnet.filops.net
      external-dns.alpha.kubernetes.io/alias: "true"
      external-dns.alpha.kubernetes.io/ttl: "60"

snapshots:
  activeDeadlineSeconds: 36000 # 10 hours
  uploads:
    enabled: true
    bucket: "filecoin-snapshots-mainnet-production"
    endpoint: "https://eafecb340a3ce23027e1eba779ed4d91.r2.cloudflarestorage.com"
    secretName: r2-access
  additionalEnv:
  - name: "FCA_CREATE_RETRIEVAL_ENDPOINT_PREFIX"
    value: "https://pub-fd31751bcb69400eb39e694385c19457.r2.dev"
  - name: "FCA_CREATE_PROGRESS_UPDATE"
    value: "60s"
  - name: "FCA_CREATE_NAME_PREFIX"
    value: "minimal/"
  - name: "GOLOG_LOG_FMT"
    value: "json"
  nodes:
  - /dns/lws-node-0-fullnode-lotus-daemon/tcp/1234
  - /dns/lws-node-1-fullnode-lotus-daemon/tcp/1234
  - /dns/lws-node-2-fullnode-lotus-daemon/tcp/1234
  - /dns/lws-node-3-fullnode-lotus-daemon/tcp/1234
  - /dns/lws-node-4-fullnode-lotus-daemon/tcp/1234
  schedule: "*/90 * * * *"
  resources:
    requests:
      cpu: "1500m"
      memory: "90Gi"
    limits:
      cpu: "2"
      memory: "95Gi"
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/name
              operator: In
              values:
              - filecoin-chain-archiver
          topologyKey: kubernetes.io/hostname
podResets:
  - pod: lws-node-0-fullnode-lotus-0
    schedule: "0 0 * * 0,2,4"
  - pod: lws-node-1-fullnode-lotus-0
    schedule: "0 8 * * 0,2,4"
  - pod: lws-node-2-fullnode-lotus-0
    schedule: "0 16 * * 0,2,4"
  - pod: lws-node-3-fullnode-lotus-0
    schedule: "0 12 * * 1,3,6"
  - pod: lws-node-4-fullnode-lotus-0
    schedule: "0 0 * * 1,3,6"
